<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Flashcard PDF</title>

  <!-- We'll embed the highlight.js theme passed in from the controller -->
  <style><%- themeCSS %></style>

  <style>
    @page {
      size: Letter;
      margin: 0; /* zero margin, if printer supports it */
    }
    html, body {
      margin: 0;
      padding: 0;
      width: 8.5in;
      height: 11in;
      font-family: Arial, sans-serif;
    }

    .page {
      position: relative;
      width: 8.5in;
      height: 11in;
      page-break-after: always;
      page-break-inside: avoid;
      overflow: hidden;
    }

    /*
      2 columns, 3.5in wide each
      4 rows spaced 2.2in apart => row offsets: 1.1, 3.3, 5.5, 7.7
      Each .card-slot is 3.5in × 2.2in
    */
    .card-slot {
      position: absolute;
      width: 3.5in;
      height: 2.2in;
      page-break-inside: avoid;
      overflow: hidden;
      z-index: 1;
    }
    /* row 1 */
    .card-slot1  { top: 1.1in; left: 0.75in; }
    .card-slot2  { top: 1.1in; left: 4.25in; }
    /* row 2 */
    .card-slot3  { top: 3.3in; left: 0.75in; }
    .card-slot4  { top: 3.3in; left: 4.25in; }
    /* row 3 */
    .card-slot5  { top: 5.5in; left: 0.75in; }
    .card-slot6  { top: 5.5in; left: 4.25in; }
    /* row 4 */
    .card-slot7  { top: 7.7in; left: 0.75in; }
    .card-slot8  { top: 7.7in; left: 4.25in; }

    /*
      .rotated-card is 2.2in × 3.5in, rotated -90° for front side
      => final orientation: 3.5in wide, 2.2in tall
    */
    .rotated-card {
      width: 2.2in;  /* must match .card-slot height */
      height: 3.5in;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-90deg);
      transform-origin: center center;
      page-break-inside: avoid;
    }

    /* For the back page: columns swapped, +90° rotation, same row offsets */
    .page-back .rotated-card {
      transform: translate(-50%, -50%) rotate(90deg);
    }
    .page-back .card-slot1  { top: 1.1in; left: 4.25in; }
    .page-back .card-slot2  { top: 1.1in; left: 0.75in; }
    .page-back .card-slot3  { top: 3.3in; left: 4.25in; }
    .page-back .card-slot4  { top: 3.3in; left: 0.75in; }
    .page-back .card-slot5  { top: 5.5in; left: 4.25in; }
    .page-back .card-slot6  { top: 5.5in; left: 0.75in; }
    .page-back .card-slot7  { top: 7.7in; left: 4.25in; }
    .page-back .card-slot8  { top: 7.7in; left: 0.75in; }

    /* Cutting/perforation lines */
    .grid-line-h, .grid-line-v {
      position: absolute;
      background: #000;
      z-index: 0;
    }
    .grid-line-h {
      left: 0.75in;
      right: 0.75in;
      height: 3px;
    }
    .grid-line-h1 { top: 1.1in; }
    .grid-line-h2 { top: 3.3in; }
    .grid-line-h3 { top: 5.5in; }
    .grid-line-h4 { top: 7.7in; }
    .grid-line-h5 { top: 9.9in; }

    .grid-line-v {
      top: 1.1in;
      bottom: calc(11in - 9.9in);
      width: 3px;
    }
    .grid-line-v1 { left: 0.75in; }
    .grid-line-v2 { left: 4.25in; }
    .grid-line-v3 { left: 7.75in; }
  </style>
</head>
<body>

<%
  // chunk "cards" in groups of 8 => front & back pages
  function getCard(cards, idx) {
    return (idx >= 0 && idx < cards.length) ? cards[idx] : null;
  }

  for (let i = 0; i < cards.length; i += 8) {
    const c0 = getCard(cards, i + 0);
    const c1 = getCard(cards, i + 1);
    const c2 = getCard(cards, i + 2);
    const c3 = getCard(cards, i + 3);
    const c4 = getCard(cards, i + 4);
    const c5 = getCard(cards, i + 5);
    const c6 = getCard(cards, i + 6);
    const c7 = getCard(cards, i + 7);
%>

<!-- ===== FRONT PAGE (up to 8 cards) ===== -->
<div class="page">
  <div class="grid-line-h grid-line-h1"></div>
  <div class="grid-line-h grid-line-h2"></div>
  <div class="grid-line-h grid-line-h3"></div>
  <div class="grid-line-h grid-line-h4"></div>
  <div class="grid-line-h grid-line-h5"></div>
  <div class="grid-line-v grid-line-v1"></div>
  <div class="grid-line-v grid-line-v2"></div>
  <div class="grid-line-v grid-line-v3"></div>

  <div class="card-slot card-slot1">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c0,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot2">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c1,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot3">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c2,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot4">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c3,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot5">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c4,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot6">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c5,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot7">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c6,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot8">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'front',
        card: c7,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
</div>

<!-- ===== BACK PAGE ===== -->
<div class="page page-back">
  <div class="grid-line-h grid-line-h1"></div>
  <div class="grid-line-h grid-line-h2"></div>
  <div class="grid-line-h grid-line-h3"></div>
  <div class="grid-line-h grid-line-h4"></div>
  <div class="grid-line-h grid-line-h5"></div>
  <div class="grid-line-v grid-line-v1"></div>
  <div class="grid-line-v grid-line-v2"></div>
  <div class="grid-line-v grid-line-v3"></div>

  <div class="card-slot card-slot1">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c0,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot2">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c1,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot3">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c2,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot4">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c3,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot5">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c4,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot6">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c5,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot7">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c6,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
  <div class="card-slot card-slot8">
    <div class="rotated-card">
      <%- include('../designs/' + style + '.ejs', {
        side: 'back',
        card: c7,
        highlightCode,
        deckName
      }) %>
    </div>
  </div>
</div>

<% } // end for chunk of 8 %>

</body>
</html>
